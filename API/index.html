<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>

    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
    <META NAME="format-detection" CONTENT="telephone=no" />
    <title> JOCKJS API</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF8" />
    <meta name="Generator" content="EditPlus">
    <meta name="Author" content="">
    <meta name="Keywords" content="">
    <meta name="Description" content="">
    <script type="text/javascript" src="http://jockjs.lunjiang.dev.anjuke.com/ujs/base/logger/dom.dom/dom.query/ajax/event/ui.panel/ui.autocomplete/ui.exposure/cookie/site/utils.base/05649b0d6dcf6ac5bed03ca14aee15a3.js"></script>
    <script>



    </script>

    <style type="text/css">
        html{




        }
        body, ul, li, p{
            margin:0;
            padding:0;
            color:#333;

        }
        .header-box {
            position: relative;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 9999;
            height: 56px;
            overflow: hidden;
            background-color: #393939;
            background-image: -webkit-gradient(linear,0% 0%, 0% 100%, from(#656565), to(#393939));
            background-image: -moz-linear-gradient(0% 0% 270deg, #656565,#393939);
        }
        .left-box {
            float: left;
            width: 100%;
            overflow: hidden;
            font-size: 1.3em;
            border-right:1px solid #aaa;
            margin-right:30px;
        }
        .call-list{
            width:100%;
            float:left;

        }
        .call-list h3{
            width:100%;
            height:24px;
            line-height:24px;
            background:#eaeaea;
            margin:0;
            padding:0;
            font-size:20px;
            text-align: left;
            font-weight:normal;
            text-indent:22px;
        }
        .call-list li{
            width:100%;
            cursor:pointer;
            font-size:13px;
            border-bottom:1px solid #ddd;
            text-indent:36px;
        }
        .call-list li span:first-child{
            font-weight: bold;
        }
        .call-list span{
            display:block;
            width:100%;
            line-height:25px;
            color:#666;
        }
        .right-box{
            display: none;
            width:70%;
            position:fixed;
            left:350px;
            float:left;
            top:45px;
            background:#fff;
        }
        .call-detail {
            float:left;
            font-size:12px;
            width:95%;
        }
        .call-detail h1{
            border-bottom:1px solid #666;
        }
        .call-detail .parms{
            font-size: 12px;
            background: #EEE;
            border: 1px dotted #CCC;
            padding: 6px;
            margin-bottom: 10px;
        }
        .explain{
            margin:32px 0px;
        }
        .title{
            color:#359;
            margin-top:60px;
            font-size:16px;
            font-weight:bold;

        }

        .code{
            margin-top:15px;
        }
        .call-detail pre {
            background: #FFFCE8;
            padding: 10px;
            line-height: 16px;
            margin: 0 10px 20px 10px;
            font-family: 'Courier New', 'Terminal', monospace;
            font-size: 12px;
            border: 1px dotted #FFE0BB;
            margin:0;
        }
        .hide{
            display:none;
        }
        .header-box {
            text-align: center;
        }
        .header-box a{
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            line-height: 40px;;
            padding: 0 10px;;
        }
        *html body
        {
            position: relative;
            margin: 0;
            height: 100%;
        }

        .dialog{
            position: fixed;
            width:900px;
            height:500px;
            position:fixed;
            top:50%;
            left:50%;
            padding: 10px;;
            margin-left: -450px;
            margin-top: -250px;;
            _position:absolute;
            _top:expression(eval(document.documentElement.scrollTop + document.documentElement.clientHeight/2));

            -webkit-box-shadow: 0px 0px 10px #999;
            -moz-box-shadow:0px 0px 10px #999;
            box-shadow:0px 0px 10px #999;
            overflow: scroll;
            background:#ccc;


        }

        *html body{
            _background-attachment: fixed;
            _background-image:url(about/blank);
        }

    </style>
</head>
<body>

<div class="header-box" id="aaa">
    <a href="#dom">DOM操作</a>
    <a href="#event">事件绑定</a>
    <a href="#component">组件应用</a>
    <a href="#dom">问题汇总</a>
    <a href="#dom">管理员操作</a>
</div>
<div class="left-box">
<div class="call-list" id="dom">
    <h3>DOM选取</h3>
    <ul>
        <li>
            <span>J.g("id")</span>
            <span>获取{id}的dom对象</span>
        </li>
        <li>
            <span>J.s(".className")</span>
            <span>获取{class}的一个数组</span>
        </li>
        <li>
            <span>J.s("tagName")</span>
            <span>获取{tagName}的一个数组</span>
        </li>
        <li>
            <span>J.s(".className1").eq()</span>
            <span>获取已获取dom对象中符合条件的子元素</span>
        </li>
        <li>
            <span>dom.setStyle({display:"none"})</span>
            <span>设置　ＤＯＭ　对像的ＣＳＳ样式</span>
        </li>
        <li>
            <span>J.g("container").getStyle("display")</span>
            <span>获取已获取dom对象的样式</span>
        </li>
        <li>
            <span>J.g("container").setOpacity:(１)</span>
            <span>设置dom对象的透明度</span>
        </li>
        <li>
            <span>J.g("container").getOpacity:("display")</span>
            <span>获取om对象的透明度</span>
        </li>
        <li>
            <span>J.g("container").get()</span>
            <span>获得dom对像的原生生对像</span>
        </li>
        <li>
            <span>J.g("container").append(dom)</span>
            <span>把dom对象插入到container后面，dom对象为原生ＤＯＭ元素或ＪＯＣＫＪＳ对象</span>
        </li>

        <li>
            <span>J.g("container").html()</span>
            <span>类似于innerHTML,不传参，返回innertHTML,传参，则设置内面的值</span>
        </li>
        <li>
            <span>J.g("container").width()</span>
            <span>获得元素的宽，其宽值为,border+padding+width，注意，隐藏的元素也能获得，原生不能获得</span>
        </li>
        <li>
            <span>J.g("container").height()</span>
            <span>获得元素的高，其高值为,border+padding+width，注意，隐藏的元素也能获得，原生不能获得</span>
        </li>

        <li>
            <span>J.g("container").offset()</span>
            <span>获得元素相对页面左上角的，Ｘ，Ｙ，返回的是一个对象{x:0,y:0}</span>
        </li>


        <li>
            <span>J.g("container").offset()</span>
            <span>获得元素相对页面左上角的，Ｘ，Ｙ，返回的是一个对象{x:0,y:0}</span>
        </li>


        <li>
            <span>dom.attr("data-tracker")</span>
            <span>获得元素属性，设置元素属生，dom.attr("data-tracker"，“１２３４”)</span>
        </li>


        <li>
            <span>dom.addClass("className")</span>
            <span>加className,相关函数，removeClass(),hasClass()</span>
        </li>



        <li>
            <span>dom.addClass("className")</span>
            <span>加className,相关函数，removeClass(),hasClass()</span>
        </li>


        <li>
            <span>dom.addClass("className")</span>
            <span>加className,相关函数，removeClass(),hasClass()</span>
        </li>


        <li>
            <span>dom.first()</span>
            <span>获得dom父节点中的第一个子节点，相关函数，last(),next(),prev()</span>
        </li>

        <li>
            <span>dom.up()</span>
            <span>获得dom元素的父节点，dom.up(1),父节点的父节点，依此类推。</span>
        </li>
        <li>
            <span>dom.down()</span>
            <span>获得dom元素的父节点，dom.up(1),父节点的父节点，依此类推。</span>
        </li>
    </ul>
</div>
<div class="call-list" id="event">
    <h3>事件</h3>
    <ul>
        <li>
            <span>each()</span>
            <span>J.s("li").each(function(k,v){
                v.addClass("focus");
            })</span>d
        </li>

        <li>
            <span>mix()</span>

            <code>
                var obj1 = {a:1,b:2};
                var obj2= {a:'a',b:'b',c:1};
                J.mix(obj1,obj2);
                console.log(obj1,obj2);
                结果：obj1={
                a:'a',
                b:'b'
                c:1
                }
            </code>
        </li>
        <li>
            <span>inArray(arg1,arg2)</span>
            <span>J.inArray("a",["a",1,1]);,arg1在arg2数组中的index,没有的话，返回-1</span>
        </li>

        <li>
            <span>J.ready()</span>
            <span>J.ready(function(){
                //DOM树渲染完毕执行的方法。不同于onload方法
            });</span>
        </li>


        <li>
            <span>J.ready()</span>
            <span>J.ready(function(){
                //DOM树渲染完毕执行的方法。不同于onload方法
            });</span>
        </li>

        <li>
            <span>J.loadResource(url,type,callback)</span>
            <pre>
             * 资源加载器，
             * 资源加载成功后会执行callback回调
             * @param {String} url 资源地址
             * @param {String} type 资源类型 || callback
             * @param {Function} callback

             如：J.loadResource("www.baidu.com/api.js",'js',function(){
                //load complete logic code
             });

            });
            </pre>
        </li>

        <li>
            <span>J.get(opts)</span>
            <pre>
            /**
             * 初始配置
             * @param {Boolean} async                 是否异步请求。默认为true（异步）
             * @param {String | Object} data         需要发送的数据。
             * @param {Object} headers               要设置的头信息
             * @return {Function} onSuccess           请求成功时触发，      function(XMLHttpRequest xhr, string responseText)
             * @return {Function} onFailure           请求失败时触发，      function(XMLHttpRequest xhr)
             * @return {Function} onBeforerequest     发送请求之前触发，    function(XMLHttpRequest xhr)
             * @return {Function} onTimeout           发送请求超时触发，    function(XMLHttpRequest xhr)
             * @param {String} cache                 是否需要缓存，默认为true（缓存）
             */


             如：
             J.get({url:'',data:{},onSuccess:function(){


             }});
             注意：这是发送GET请求。超过5S未返回，将会取消ajax.J.post():类似。
             跨跨的话，onSuccess无法执行，需要自定议callback为一全局方法。
            </pre>
        </li>

        <li>
            <span>绑定事件：J.g("container").on(type,handler)</span>
            <pre>
                为ID为 container的对象绑定事件，如
                J.g("container").on(‘click’,function(){

                })
                ,解绑事件，J.un(type,handler);
            </pre>
        </li>



        <li>
            <span>cookeie获取：J.getCookie("ctid")</span>
            <pre>
                获取name为ctid的值
            </pre>
        </li>

        <li>
            <span>cooke获取：J.setCookie("ctid")</span>
            <pre>
                获取name为ctid的值
            </pre>
        </li>


    </ul>
</div>

<div class="call-list" id="component">
    <h3>组件应用</h3>
    <ul>
        <li>
            <dl>
               <dt>autocomplete 输入联想框</dt>
                <dd>
                    <div contenteditable="true">
                <pre>
                        参数说明：
                        {
                        width:宽度，可以不传，默认为input框的宽宽,
                        placeholder:默认显示文案，配合toggleClass使用，如果input框值为空的话，input显示的值为placeholder的值，并且会移除掉toogleClas,
                        params: {
                            name:'123'//每次请求附带的参数
                        },
                        dataKey:'list',//服务器返回参数可能不是一个数组，而是一个json，如{num:12,data:[name:'安',name:'居',name:'客',name:'专业',name:'找房',]}，这时候我们需要指定dataKey为data
                        offset:{
                        x: 0,// 正常情况，autocomplete在紧贴input框左下角，但是有可有计算有误差，需要手动向左或向右偏差１～几像素。
                        y: 0// 正常情况，autocomplete在紧贴input框左下角，但是有可有计算有误差，需要手动向上或向下偏差１～几像素。
                        },
                        cache:true,//默让true,当用户输入同样的关键字就会被缓存
                        autoSubmit:false,选中值后是否提交表单
                        url: '/API/index.php',//ajax请求的地址
                        tpl: "autocomplete_ajk",//皮肤，不是特殊需求就不改了
                        toggleClass: "kw_hover",//值为空时会移除掉这个class
                        itemBuild:function(item){//当服务器返回json数组时，对于每一项取值的key
                            return {
                                l:item.name
                            }
                        },
                        source:null,//可以为数组或方法，当为数组的时候，固定返回联想项，当为方法时下面会价绍
                        onSelect:function(data){//选中下拉框某一项触发的事件
                            应用于选中的值不是想要的值
                        },

                        onBlur:function(){//输入框失去焦点的事件
                        },

                        onKeyUp:function(elm){//
                        },

                        onChange:function(item){//按上下键，输入框值会变化的事件。
                            应用于修改上下键input框中的值不是默认文字处理
                        }
                        }
                 </pre>
                    </div>
                </dd>
                <dd>
                    1.普通ajax请求<input type="button" onclick="toggle(this)" value="view demo" />
                    <div id="auto_demo1" style="display: none">
                        <input type="text" value="" id="auto" name="k"/>
                        <input type="button" value="查看源代码" onclick="showDialog(this)"/>
                        <script type="text/javascript" id="code1">
                            (function(){
                                J.g("auto").autocomplete({
                                    width:'',
                                    placeholder: "click me",
                                    params: {
                                    },
                                    dataKey:'list',
                                    offset:{
                                        x: 0,
                                        y: 0
                                    },
                                    type:'json',
                                    cache:true,
                                    autoSubmit:false,
                                    url: '/API/index.php',
                                    tpl: "autocomplete_ajk",
                                    toggleClass: "kw_hover",
                                    itemBuild:function(item){
                                        return {
                                            l:item.keyword,
                                            v:item.keyword
                                        }
                                    },
                                    source:null,
                                    onSelect:function(data){
                                    },

                                    onBlur:function(){
                                    },

                                    onKeyUp:function(elm){
                                    },

                                    onChange:function(elm){
                                    }
                                })
                            }).require([],['ui.autocomplete_ajk'],true)
                        </script>
                        <textarea cols="200" rows="40" style="display: none"></textarea>
                    </div>
                </dd>
                <dd>
                    2.跨域ajax请求<input type="button" onclick="toggle(this)" value="view demo" />
                    <div id="auto_demo2" style="display: none">
                        <input type="text" value="" id="auto2" name="k"/>
                        <input type="button" value="查看源代码" onclick="showDialog(this)"/>
                        <script type="text/javascript" id="code2">
                            (function(){
                                J.g("auto2").autocomplete({
                                    width:'',
                                    placeholder: "click me",
                                    params: {
                                    },
                                    dataKey:'list',
                                    offset:{
                                        x: 0,
                                        y: 0
                                    },
                                    cache:true,
                                    autoSubmit:false,
                                    url: '/API/index.php',
                                    tpl: "autocomplete_ajk",
                                    toggleClass: "kw_hover",
                                    itemBuild:function(item){
                                        return {
                                            l:item.keyword,
                                            v:item.keyword
                                        }
                                    },
                                    source:function(request,response){
                                        window.callback= function(data){
                                            response(data.list);
                                        }
                                        J.get({
                                            type:'jsonp',
                                            url:'http://test.lunjiang.dev.aifang.com/API/index.php?callback=window.callback',
                                            data:request
                                        })
                                    },
                                    onSelect:function(data){
                                    },

                                    onBlur:function(){
                                    },

                                    onKeyUp:function(elm){
                                    },

                                    onChange:function(elm){
                                    }
                                })
                            }).require([],['ui.autocomplete_ajk'],true)
                        </script>
                        <textarea cols="200" rows="40" style="display: none"></textarea>
                    </div>
                </dd>
               <dd>
                   3.无ajax联想<input type="button" onclick="toggle(this)" value="view demo" />
                   <div id="auto_demo3" style="display: none">
                       <input type="text" value="" id="auto3" name="k"/>
                       <input type="button" value="查看源代码" onclick="showDialog(this)"/>
                       <script type="text/javascript" id="code3">
                           (function(){
                                   J.g('auto3').autocomplete({
                                           url:'',
                                           tpl:'autocomplete_ajk',
                                           width:"228",
                                           offset:{
                                               x:0,
                                               y:0
                                           },
                                           autoSubmit:false,
                                           forceClear:false,
                                           source:[{mail:'@qq.com'},{mail:'@163.com'},{mail:'@126.com'},{mail:'@hotmail.com'},{mail:'@gmail.com'},{mail:'@263.com'},{mail:'@sina.com'},{mail:'@sohu.com'}],
                                           dataMap:function(data){
                                               data.l = data.mail;
                                               data.v = data.mail;
                                               return data;
                                           },
                                           itemBuild:function(item){
                                               var strlable = item.l;
                                               var input = J.g('auto3').val();
                                               var index = input.indexOf('@');
                                               if(index>-1){
                                                   var substr = input.substr(index+1);
                                                   var reg = new RegExp('@'+substr);
                                                   if(!reg.test(strlable)){
                                                       return {
                                                           l:'',
                                                           v:''
                                                       }
                                                   }
                                                   input = input.replace(/@.*/g,'');
                                               }
                                               return {
                                                   l:input+strlable,
                                                   v:input+item.v
                                                   //   v:item.l
                                               }
                                           },
                                           onFocus:function(ele){
                                           },
                                           onBlur:function(e){
                                               J.g("auto3").removeClass("green_clolr");
                                           },
                                           onForceClear:function(){
                                           },
                                           onSelect:function(data){
                                               J.g('auto3').val(data.l);
                                               return;
                                           },
                                           onResult:function(obj,data){//有返回结果
                                               //   alert(data.length)
                                               return;
                                           }
                                       });
                           }).require(['ui.autocomplete'],['ui.autocomplete_ajk'],true)
                       </script>
                       <textarea cols="200" rows="40" style="display: none"></textarea>
                   </div>
               </dd>

            </dl>


        </li>

        <li>
        <dl>
        <dt>曝光量组件</dt>
        <dd>
            <div>
                本组件主要功能是使用户看到的网页中的a 标签加上事件追踪。如以链接，会在用户滚动到可视区域的时候，会发送暴光请求,发送过后不会再继续发送。</br>
                1.只会对a标答中含有：data-trace="{viewandview_1:193555672}",其实{viewandview_1:193555672}自定义，但是data-trac有必须含有。</br>
                ２.如果异步加载进来的a标签，需要手动把符合要求的链接加进去，如二手房推荐位。
                    <div style="color: red">global.exposure.add(J.g("HistoryContent").s("a")</div>
                ３。二手房已经做成了component，在需要用的页面只需要在__construct加上：__construct 加上$this->show_exposure = true;即可，然后在页面加上上含有data-trace属性的a标签即可。
                <pre>
                  <a target="_blank" data-trace="{viewandview_1:193555672}" title="中心花园景观位置 正气楼王两房 40万豪华装修全送 随时看房" class="name" href="http://shanghai.anjuke.com/prop/view/193555672?from=anjuke_page_rec_right&amp;spread=proprec_p&amp;mahout=2&amp;position=1" pos="0">中心花园景观位置 正气楼王两房 40万豪华装修全送 随时看房</a>
                </pre>
            </div>
        </dd>
        <dd>
            <div id="auto_demo1">
                <input type="button" value="查看源代码" onclick="showDialog(this)"/>
                <script type="text/javascript" id="code1">
                    (function(){
                        var exposure =  new J.ui.exposure()
                        exposure.setSite("anjuke-exposure-npv");
                        exposure.setPage("Findingv2_SaleFilterPage");
                        exposure.setPageName("Findingv2_SaleFilterPage");
                        exposure.setReferrer(document.referrer);
                        exposure.setNGuid("aQQ_ajkguid");
                        exposure.setNUid("ajk_member_id");
                        exposure.start();
                    })();
                </script>
                <textarea cols="200" rows="40" style="display: none"></textarea>
            </div>
        </dd>

        </dl>


        </li>


    </ul>
</div>

</div>
</div>
<script type="text/javascript">
    function toggle(elm){
        elm =elm.nextSibling;
        while(elm&&(elm.nodeType == 3)){
            elm = elm.nextSibling;
        }
        elm.style.display === "none" ? elm.style.display="" : elm.style.display="none";
    }
    function showDialog(elm){
        elm = elm.nextSibling;
        while(elm&&(elm.nodeType == 3)){
            elm = elm.nextSibling;
        }
        var text = elm.innerHTML;
        var div = document.createElement("div");
        div.setAttribute("contentEditable",true)
        div.className="dialog";

        var pre = document.createElement("pre");

        pre.style.width="100%";
        pre.style.height="100%";
        pre.style.margin="0";
        pre.innerText ? (pre.innerText= text):(pre.textContent = text);
        pre.innerText=text;
        div.appendChild(pre)
        document.body.appendChild(div);

        div.onclick= function(e){
            var evt = e|| window.event;
            (evt.stopPropagation&&(evt.stopPropagation(),true), evt.cancelBubble=true)
        };
        pre.onclick= function(e){
            var evt = e|| window.event;
            (evt.stopPropagation&&(evt.stopPropagation(),true), evt.cancelBubble=true)

        };
        (document.addEventListener&&document.addEventListener('click',function(e){
            var e = e|| window.event;
            var target = e.srcElement || e.target;
            if(target === div || target === pre){
                return;
            }
            document.removeEventListener('click',arguments.callee);
            div&&div.parentNode.removeChild(div);
            div = null;
        },true),true)|| (document.attachEvent('click',function(e){
            var e = e|| window.event;
            var target = e.srcElement || e.target;
            if(target === div || target === pre){
                return;
            }
            document.detachEvent('click',arguments.callee);
            div&&div.parentNode.removeChild(div);
            div = null;

        }));

    }
    (function(){
        console.log(J.ui.slide)
    }).require(['ui.slide'],'')


</script>

</body>
</html>

